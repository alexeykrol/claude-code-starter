# Makefile for Project_init
# This file simplifies executing typical commands and allows Claude Code to control what runs

.PHONY: help dev build test lint typecheck security clean install audit fix-lint

# Show help by default
.DEFAULT_GOAL := help

## help: Show this help message
help:
	@echo "Available commands:"
	@echo ""
	@sed -n 's/^##//p' ${MAKEFILE_LIST} | column -t -s ':' | sed -e 's/^/ /'
	@echo ""

## dev: Start development server
dev:
	@echo "ğŸš€ Starting development server..."
	npm run dev

## build: Build project for production
build:
	@echo "ğŸ“¦ Building project..."
	npm run build

## start: Start production server (after build)
start:
	@echo "â–¶ï¸  Starting production server..."
	npm run start

## test: Run all tests
test:
	@echo "ğŸ§ª Running tests..."
	npm run test

## test-watch: Run tests in watch mode
test-watch:
	@echo "ğŸ‘€ Running tests in watch mode..."
	npm run test:watch

## lint: Check code with linter
lint:
	@echo "ğŸ” Checking code with linter..."
	npm run lint

## fix-lint: Auto-fix linter issues
fix-lint:
	@echo "ğŸ”§ Auto-fixing linter..."
	npm run lint -- --fix

## typecheck: Check TypeScript types
typecheck:
	@echo "ğŸ“˜ Checking TypeScript types..."
	npm run type-check

## security: Check security (npm audit)
security:
	@echo "ğŸ” Security check..."
	npm audit
	@echo ""
	@echo "To auto-fix: make security-fix"

## security-fix: Auto-fix vulnerabilities
security-fix:
	@echo "ğŸ” Auto-fixing vulnerabilities..."
	npm audit fix

## audit: Full project check (lint + typecheck + test + security)
audit:
	@echo "ğŸ” Full project check..."
	@make lint
	@make typecheck
	@make test
	@make security

## install: Install dependencies
install:
	@echo "ğŸ“¥ Installing dependencies..."
	npm install

## clean: Clean build artifacts and node_modules
clean:
	@echo "ğŸ§¹ Cleaning project..."
	rm -rf node_modules .next dist build out
	@echo "âœ… Project cleaned"

## reinstall: Reinstall all dependencies (clean + install)
reinstall: clean install
	@echo "âœ… Dependencies reinstalled"

## format: Format code (Prettier)
format:
	@echo "âœ¨ Formatting code..."
	npm run format

## db-migrate: Run database migrations
db-migrate:
	@echo "ğŸ—„ï¸  Running DB migrations..."
	npm run db:migrate

## db-reset: Reset DB and apply migrations
db-reset:
	@echo "âš ï¸  Resetting DB..."
	npm run db:reset

## db-seed: Seed DB with test data
db-seed:
	@echo "ğŸŒ± Seeding DB with test data..."
	npm run db:seed

## pre-commit: Pre-commit checks (lint + typecheck)
pre-commit:
	@echo "âœ… Pre-commit checks..."
	@make lint
	@make typecheck
	@echo "âœ… Ready to commit!"

## pre-push: Pre-push checks (audit + build)
pre-push:
	@echo "âœ… Pre-push checks..."
	@make audit
	@make build
	@echo "âœ… Ready to push!"

## init: Initial project setup (for new developers)
init:
	@echo "ğŸ‰ Initializing project..."
	@make install
	@cp -n .env.example .env.local || echo ".env.local already exists"
	@echo ""
	@echo "âœ… Project initialized!"
	@echo ""
	@echo "Next steps:"
	@echo "1. Edit .env.local with required variables"
	@echo "2. Run 'make dev' to start development server"

## doctor: Environment diagnostics (check everything is installed)
doctor:
	@echo "ğŸ”¬ Environment diagnostics..."
	@echo ""
	@echo "Node.js version:"
	@node --version || echo "âŒ Node.js not installed"
	@echo ""
	@echo "npm version:"
	@npm --version || echo "âŒ npm not installed"
	@echo ""
	@echo "git version:"
	@git --version || echo "âŒ git not installed"
	@echo ""
	@echo "gh CLI version:"
	@gh --version || echo "âš ï¸  gh CLI not installed (optional)"
	@echo ""
	@test -f .env.local && echo "âœ… .env.local exists" || echo "âš ï¸  .env.local not found"
	@test -d node_modules && echo "âœ… node_modules installed" || echo "âš ï¸  node_modules not installed (run: make install)"
